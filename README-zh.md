[English](README.md) | [ä¸­æ–‡](README-zh.md)

# R2 Cycling App

R2 Cycling App æ˜¯ä¸€ä¸ªä¸“ä¸ºéª‘è¡Œçˆ±å¥½è€…è®¾è®¡çš„å¼€æºç»¼åˆæ€§ Flutter ç§»åŠ¨åº”ç”¨ç¨‹åºï¼Œä¸º Android å’Œ iOS å¹³å°æä¾›æ™ºèƒ½å¤´ç›”é›†æˆå’Œå®‰å…¨åŠŸèƒ½ã€‚

## ä¸»è¦åŠŸèƒ½
ðŸš´â€â™‚ï¸ æ™ºèƒ½å¤´ç›”é›†æˆ
- ä¸Žæ™ºèƒ½å¤´ç›”çš„è“ç‰™é…å¯¹ï¼ˆEH201 ç³»åˆ—ï¼‰
- è®¾å¤‡ç®¡ç†å’ŒæŽ§åˆ¶ï¼ˆéŸ³é‡ã€ç…§æ˜Žï¼‰
- è“ç‰™ç”µè¯å’ŒéŸ³ä¹åŠŸèƒ½

ðŸ“ž ç¾¤ç»„é€šä¿¡
- ä½¿ç”¨ 4 ä½æ•°å­—ä»£ç åˆ›å»ºå’ŒåŠ å…¥éª‘è¡Œç¾¤ç»„
- ä½¿ç”¨ Agora RTC æŠ€æœ¯è¿›è¡Œå®žæ—¶ç¾¤ç»„è¯­éŸ³å¯¹è®²

ðŸ†˜ ç´§æ€¥å®‰å…¨ç³»ç»Ÿ
- SOS ç´§æ€¥è”ç³»äººç®¡ç†
- è‡ªåŠ¨è·Œå€’æ£€æµ‹å’Œä½ç½®åˆ†äº«
- å‘ç´§æ€¥è”ç³»äººå‘é€å¸¦ä½ç½®ä¿¡æ¯çš„çŸ­ä¿¡è­¦æŠ¥

ðŸ‘¤ ç”¨æˆ·ç®¡ç†
- ç”¨æˆ·æ³¨å†Œå’Œèº«ä»½éªŒè¯ç³»ç»Ÿ

ðŸŒ å¤šè¯­è¨€æ”¯æŒ
- å®Œæ•´çš„å›½é™…åŒ–æ”¯æŒï¼ˆè‹±æ–‡å’Œä¸­æ–‡ï¼‰
- æœ¬åœ°åŒ–ç”¨æˆ·ç•Œé¢å’Œå†…å®¹

## å¼€æºå£°æ˜Ž
æœ¬é¡¹ç›® R2 Cycling App é‡‡ç”¨ Apache License 2.0 å¼€æºåè®®ã€‚
æœåŠ¡å™¨ç«¯çš„å®žçŽ°ä»£ç ä¸åœ¨å¼€æºèŒƒå›´ï¼Œä»…å…¬å¼€ API æ–‡æ¡£ï¼Œä¾›å¼€å‘è€…ä¸ŽåŽ‚å•†é›†æˆä½¿ç”¨ã€‚

âœ… ä½ å¯ä»¥è‡ªç”±åœ°ï¼š
	â€¢	å°†æœ¬Appæºä»£ç ç”¨äºŽä¸ªäººæˆ–å•†ä¸šäº§å“ï¼›
	â€¢	ä¿®æ”¹ã€åˆ†å‘ã€å†å‘å¸ƒæœ¬ä»£ç ï¼›
	â€¢	åœ¨äº§å“ä¸­é›†æˆR2Cyclingçš„APIï¼Œéœ€éµå¾ªæ–‡æ¡£è§„èŒƒã€‚

âš ï¸ ä½ éœ€è¦éµå®ˆï¼š
	â€¢	åœ¨åˆ†å‘æœ¬ä»£ç æˆ–è¡ç”Ÿä½œå“æ—¶ï¼Œä¿ç•™åŽŸå§‹çš„ç‰ˆæƒä¸Žè®¸å¯è¯å£°æ˜Žï¼›
	â€¢	å¦‚æžœä¿®æ”¹äº†ä»£ç ï¼Œéœ€è¦åœ¨ NOTICE æ–‡ä»¶ä¸­æ ‡æ˜Žï¼›
	â€¢	ä½¿ç”¨æœ¬é¡¹ç›®çš„è¿‡ç¨‹ä¸­ï¼Œä¸è‡ªåŠ¨èŽ·å¾—â€œR2Cyclingâ€åŠå…¶ Logo çš„å•†æ ‡ä½¿ç”¨æƒï¼›
	â€¢	è‹¥å¯¹é¡¹ç›®æäº¤ä»£ç è´¡çŒ®ï¼Œåˆ™è§†ä¸ºåŒæ„æŽˆäºˆç›¸åº”çš„ä¸“åˆ©æŽˆæƒï¼ˆè§ Apache-2.0 åè®®æ¡æ¬¾ï¼‰ã€‚

âŒ ä¸åŒ…æ‹¬ï¼š
	â€¢	æœ¬ä»“åº“ä¸åŒ…å«æœåŠ¡å™¨ç«¯å®žçŽ°ä»£ç ï¼›
	â€¢	æœ¬å¼€æºåè®®ä¸æŽˆäºˆä»»ä½•å•†æ ‡ä½¿ç”¨æƒï¼›
	â€¢	ä¸Žæœ¬é¡¹ç›®APIäº¤äº’æ‰€éœ€çš„ç”Ÿäº§çŽ¯å¢ƒæœåŠ¡ç”±å„åŽ‚å•†è‡ªè¡Œéƒ¨ç½²æˆ–ä½¿ç”¨å®˜æ–¹æœåŠ¡ã€‚

è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## å¿«é€Ÿå¼€å§‹æŒ‡å—

### å‰ç½®è¦æ±‚

å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²å®‰è£…ä»¥ä¸‹è½¯ä»¶ï¼š
- **Flutter SDK** (>=3.4.3)ï¼š[å®‰è£… Flutter](https://docs.flutter.dev/get-started/install)
- **Dart SDK**ï¼ˆFlutter è‡ªå¸¦ï¼‰
- **Android Studio** æˆ– **Xcode**ï¼ˆç”¨äºŽ iOS å¼€å‘ï¼‰
- **Git** ç‰ˆæœ¬æŽ§åˆ¶å·¥å…·

### 1. ä¸‹è½½æºä»£ç 

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/your-username/r2cyclingapp.git
cd r2cyclingapp
```

### 2. è®¾ç½®å¼€å‘çŽ¯å¢ƒ

#### Android å¼€å‘ï¼š
- å®‰è£… [Android Studio](https://developer.android.com/studio)
- å®‰è£… Android SDKï¼ˆAPI çº§åˆ« 21 æˆ–æ›´é«˜ï¼‰
- è®¾ç½® Android è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨

#### iOS å¼€å‘ï¼ˆä»…é™ macOSï¼‰ï¼š
- ä»Ž App Store å®‰è£… [Xcode](https://developer.apple.com/xcode/)
- å®‰è£… Xcode å‘½ä»¤è¡Œå·¥å…·ï¼š`xcode-select --install`
- è®¾ç½® iOS è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨

### 3. å®‰è£…æ‰€éœ€åŒ…

```bash
# èŽ·å– Flutter ä¾èµ–
flutter pub get

# éªŒè¯ Flutter å®‰è£…
flutter doctor
```

### 4. é¢„ç¼–è¯‘è®¾ç½®

#### é…ç½®æƒé™ï¼ˆé‡è¦ï¼ï¼‰ï¼š
æ­¤åº”ç”¨éœ€è¦å¤šé¡¹æƒé™æ‰èƒ½æ­£å¸¸è¿è¡Œï¼š

**Android**ï¼šæƒé™é€šè¿‡ `android/app/src/main/AndroidManifest.xml` è‡ªåŠ¨å¤„ç†

**iOS**ï¼šæ›´æ–° `ios/Runner/Info.plist` æ·»åŠ æ‰€éœ€æƒé™ï¼š
- è“ç‰™ä½¿ç”¨æƒé™
- ä½ç½®è®¿é—®æƒé™
- éº¦å…‹é£Žè®¿é—®æƒé™
- çŸ­ä¿¡å‘é€æƒé™

#### API é…ç½®ï¼š
æ›´æ–° `lib/constants.dart` ä¸­çš„ API ç«¯ç‚¹ï¼ŒæŒ‡å‘æ‚¨çš„åŽç«¯æœåŠ¡ã€‚

### 5. æž„å»ºå’Œç¼–è¯‘

#### Androidï¼š
```bash
# è°ƒè¯•æž„å»º
flutter run

# å‘å¸ƒ APK
flutter build apk --release

# å‘å¸ƒ App Bundleï¼ˆæŽ¨èç”¨äºŽ Play Storeï¼‰
flutter build appbundle --release
```

#### iOSï¼š
```bash
# è°ƒè¯•æž„å»º
flutter run

# å‘å¸ƒæž„å»º
flutter build ios --release
```

### 6. éƒ¨ç½²åˆ°è®¾å¤‡

#### Android è®¾å¤‡ï¼š
1. åœ¨ Android è®¾å¤‡ä¸Šå¯ç”¨å¼€å‘è€…é€‰é¡¹å’Œ USB è°ƒè¯•
2. é€šè¿‡ USB è¿žæŽ¥è®¾å¤‡
3. è¿è¡Œï¼š`flutter run` æˆ–ä»Ž `build/app/outputs/flutter-apk/` å®‰è£… APK

#### iPhoneï¼š
1. é€šè¿‡ USB è¿žæŽ¥ iPhone
2. åœ¨è®¾å¤‡ä¸Šä¿¡ä»»æ­¤è®¡ç®—æœº
3. åœ¨ Xcode ä¸­æ‰“å¼€ `ios/Runner.xcworkspace`
4. é€‰æ‹©æ‚¨çš„è®¾å¤‡å¹¶ç‚¹å‡»"è¿è¡Œ"
5. æ‚¨å¯èƒ½éœ€è¦åœ¨ Xcode ä¸­é…ç½®ä»£ç ç­¾å

### 7. æ•…éšœæŽ’é™¤

**å¸¸è§é—®é¢˜ï¼š**
- **Flutter Doctor é—®é¢˜**ï¼šè¿è¡Œ `flutter doctor` å¹¶æŒ‰ç…§å»ºè®®æ“ä½œ
- **ä¾èµ–å†²çª**ï¼šå°è¯• `flutter clean && flutter pub get`
- **iOS ä»£ç ç­¾å**ï¼šç¡®ä¿æ‚¨æœ‰æœ‰æ•ˆçš„ Apple å¼€å‘è€…è´¦æˆ·
- **Android æž„å»ºé—®é¢˜**ï¼šæ£€æŸ¥ Android SDK å’Œæž„å»ºå·¥å…·ç‰ˆæœ¬

**å…³é”®ä¾èµ–ï¼š**
- Agora RTC Engineï¼ˆç”¨äºŽè¯­éŸ³é€šä¿¡ï¼‰
- Flutter Reactive BLEï¼ˆç”¨äºŽè“ç‰™è¿žæŽ¥ï¼‰
- Geolocatorï¼ˆç”¨äºŽä½ç½®æœåŠ¡ï¼‰
- Permission Handlerï¼ˆç”¨äºŽè¿è¡Œæ—¶æƒé™ï¼‰

### 8. å¼€å‘æç¤º

- ä½¿ç”¨ `flutter run --hot-reload` è¿›è¡Œå¿«é€Ÿå¼€å‘
- ä½¿ç”¨ `flutter logs` è¿›è¡Œè°ƒè¯•
- åœ¨ Android å’Œ iOS è®¾å¤‡ä¸Šæµ‹è¯•ä»¥ç¡®ä¿æœ€ä½³å…¼å®¹æ€§
- ç¡®ä¿æŽˆäºˆæ‰€æœ‰å¿…éœ€æƒé™ä»¥å®žçŽ°å®Œæ•´åŠŸèƒ½
æ›´å¤š Flutter å¼€å‘èµ„æºï¼Œè¯·è®¿é—®[å®˜æ–¹æ–‡æ¡£](https://docs.flutter.dev/)ã€‚

## ä»“åº“ç›®å½•æ ‘

```
r2cyclingapp/                    # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ android/                     # Android å¹³å°é…ç½®
â”‚   â”œâ”€â”€ app/                     # Android åº”ç”¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ build.gradle         # Android åº”ç”¨æž„å»ºé…ç½®
â”‚   â”‚   â””â”€â”€ src/                 # Android æºä»£ç 
â”‚   â”œâ”€â”€ build.gradle             # Android é¡¹ç›®æž„å»ºé…ç½®
â”‚   â”œâ”€â”€ gradle/                  # Gradle åŒ…è£…å™¨
â”‚   â”œâ”€â”€ gradle.properties        # Gradle å±žæ€§
â”‚   â””â”€â”€ settings.gradle          # Gradle è®¾ç½®
â”œâ”€â”€ ios/                         # iOS å¹³å°é…ç½®
â”‚   â”œâ”€â”€ Flutter/                 # Flutter iOS é…ç½®
â”‚   â”œâ”€â”€ Runner/                  # iOS åº”ç”¨ç›®æ ‡
â”‚   â”‚   â”œâ”€â”€ AppDelegate.swift    # iOS åº”ç”¨å§”æ‰˜
â”‚   â”‚   â”œâ”€â”€ Assets.xcassets/     # iOS åº”ç”¨èµ„æº
â”‚   â”‚   â”œâ”€â”€ Base.lproj/          # iOS æœ¬åœ°åŒ–
â”‚   â”‚   â””â”€â”€ Info.plist           # iOS åº”ç”¨ä¿¡æ¯
â”‚   â”œâ”€â”€ Runner.xcodeproj/        # Xcode é¡¹ç›®
â”‚   â””â”€â”€ RunnerTests/             # iOS å•å…ƒæµ‹è¯•
â”œâ”€â”€ lib/                         # Flutter Dart æºä»£ç 
â”‚   â”œâ”€â”€ connection/              # ç½‘ç»œå’Œè“ç‰™è¿žæŽ¥
â”‚   â”‚   â”œâ”€â”€ bt/                  # è“ç‰™è¿žæŽ¥æ¨¡å—
â”‚   â”‚   â””â”€â”€ http/                # HTTP API è¿žæŽ¥æ¨¡å—
â”‚   â”œâ”€â”€ database/                # æœ¬åœ°æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ r2_db_helper.dart    # SQLite æ•°æ®åº“åŠ©æ‰‹
â”‚   â”‚   â””â”€â”€ r2_storage.dart      # æœ¬åœ°å­˜å‚¨å·¥å…·
â”‚   â”œâ”€â”€ devicemanager/           # æ™ºèƒ½å¤´ç›”è®¾å¤‡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ r2_device.dart       # è®¾å¤‡æ¨¡åž‹
â”‚   â”‚   â””â”€â”€ r2_device_manager.dart # è®¾å¤‡è¿žæŽ¥ç®¡ç†å™¨
â”‚   â”œâ”€â”€ emergency/               # ç´§æ€¥å’Œ SOS åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ contact_widget.dart  # ç´§æ€¥è”ç³»äºº UI
â”‚   â”‚   â”œâ”€â”€ emergency_contact_screen.dart # ç´§æ€¥è”ç³»äººå±å¹•
â”‚   â”‚   â”œâ”€â”€ r2_sms.dart          # çŸ­ä¿¡å‘é€åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ r2_sos_sender.dart   # SOS æ¶ˆæ¯å‘é€å™¨
â”‚   â”‚   â””â”€â”€ sos_widget.dart      # SOS æŒ‰é’® UI
â”‚   â”œâ”€â”€ group/                   # ç¾¤ç»„é€šä¿¡åŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ create_group_screen.dart # åˆ›å»ºç¾¤ç»„å±å¹•
â”‚   â”‚   â”œâ”€â”€ group_intercom_screen.dart # ç¾¤ç»„å¯¹è®²å±å¹•
â”‚   â”‚   â”œâ”€â”€ group_list_screen.dart # ç¾¤ç»„åˆ—è¡¨å±å¹•
â”‚   â”‚   â””â”€â”€ join_group_screen.dart # åŠ å…¥ç¾¤ç»„å±å¹•
â”‚   â”œâ”€â”€ intercom/                # å®žæ—¶è¯­éŸ³é€šä¿¡
â”‚   â”‚   â””â”€â”€ r2_intercom_engine.dart # Agora RTC å¼•æ“ŽåŒ…è£…å™¨
â”‚   â”œâ”€â”€ l10n/                    # å›½é™…åŒ–
â”‚   â”‚   â””â”€â”€ app_localizations.dart # åº”ç”¨æœ¬åœ°åŒ–å­—ç¬¦ä¸²
â”‚   â”œâ”€â”€ login/                   # ç”¨æˆ·è®¤è¯
â”‚   â”‚   â”œâ”€â”€ login_base_screen.dart # åŸºç¡€ç™»å½•å±å¹•
â”‚   â”‚   â”œâ”€â”€ password_recover_screen.dart # å¯†ç æ¢å¤
â”‚   â”‚   â”œâ”€â”€ password_setting_screen.dart # å¯†ç è®¾ç½®
â”‚   â”‚   â”œâ”€â”€ user_login_screen.dart # ç”¨æˆ·ç™»å½•å±å¹•
â”‚   â”‚   â”œâ”€â”€ user_register_screen.dart # ç”¨æˆ·æ³¨å†Œå±å¹•
â”‚   â”‚   â””â”€â”€ verification_screen.dart # éªŒè¯ç å±å¹•
â”‚   â”œâ”€â”€ permission/              # åº”ç”¨æƒé™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ permission_dialog.dart # æƒé™è¯·æ±‚å¯¹è¯æ¡†
â”‚   â”‚   â”œâ”€â”€ r2_permission_manager.dart # æƒé™ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ r2_permission_model.dart # æƒé™æ¨¡åž‹
â”‚   â”œâ”€â”€ r2controls/              # è‡ªå®šä¹‰ UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ r2_flash.dart        # é—ªçŽ°æ¶ˆæ¯ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ r2_flat_button.dart  # è‡ªå®šä¹‰æŒ‰é’®ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ r2_loading_indicator.dart # åŠ è½½æŒ‡ç¤ºå™¨
â”‚   â”‚   â””â”€â”€ r2_user_text_field.dart # è‡ªå®šä¹‰æ–‡æœ¬å­—æ®µ
â”‚   â”œâ”€â”€ screens/                 # ä¸»è¦åº”ç”¨å±å¹•
â”‚   â”‚   â”œâ”€â”€ device_pairing_screen.dart # è®¾å¤‡é…å¯¹å±å¹•
â”‚   â”‚   â”œâ”€â”€ helmet_screen.dart   # å¤´ç›”ç®¡ç†å±å¹•
â”‚   â”‚   â”œâ”€â”€ home_screen.dart     # ä¸»é¡µå±å¹•
â”‚   â”‚   â””â”€â”€ splash_screen.dart   # åº”ç”¨å¯åŠ¨å±å¹•
â”‚   â”œâ”€â”€ service/                 # åŽå°æœåŠ¡
â”‚   â”‚   â””â”€â”€ r2_background_service.dart # åŽå°ä»»åŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ settings/                # åº”ç”¨è®¾ç½®å’Œç”¨æˆ·èµ„æ–™
â”‚   â”‚   â”œâ”€â”€ image_cut_screen.dart # å›¾åƒè£å‰ªå±å¹•
â”‚   â”‚   â”œâ”€â”€ settings_screen.dart # åº”ç”¨è®¾ç½®å±å¹•
â”‚   â”‚   â””â”€â”€ user_profile_screen.dart # ç”¨æˆ·èµ„æ–™å±å¹•
â”‚   â”œâ”€â”€ usermanager/             # ç”¨æˆ·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ r2_account.dart      # ç”¨æˆ·è´¦æˆ·æ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ r2_group.dart        # ç¾¤ç»„æ¨¡åž‹
â”‚   â”‚   â”œâ”€â”€ r2_user_manager.dart # ç”¨æˆ·ç®¡ç†æœåŠ¡
â”‚   â”‚   â””â”€â”€ r2_user_profile.dart # ç”¨æˆ·èµ„æ–™æ¨¡åž‹
â”‚   â”œâ”€â”€ constants.dart           # åº”ç”¨å¸¸é‡
â”‚   â””â”€â”€ main.dart                # åº”ç”¨å…¥å£ç‚¹
â”œâ”€â”€ assets/                      # é™æ€èµ„æº
â”‚   â”œâ”€â”€ icons/                   # åº”ç”¨å›¾æ ‡
â”‚   â””â”€â”€ images/                  # åº”ç”¨å›¾ç‰‡
â”œâ”€â”€ test/                        # å•å…ƒæµ‹è¯•
â”‚   â””â”€â”€ widget_test.dart         # ç»„ä»¶æµ‹è¯•
â”œâ”€â”€ .gitignore                   # Git å¿½ç•¥è§„åˆ™
â”œâ”€â”€ .metadata                    # Flutter å…ƒæ•°æ®
â”œâ”€â”€ analysis_options.yaml        # Dart åˆ†æžé€‰é¡¹
â”œâ”€â”€ pubspec.yaml                 # Flutter ä¾èµ–
â”œâ”€â”€ pubspec.lock                 # ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ LICENSE                      # Apache License 2.0
â”œâ”€â”€ README.md                    # è‹±æ–‡æ–‡æ¡£
â””â”€â”€ README-zh.md                 # ä¸­æ–‡æ–‡æ¡£
```

## R2 Cycling App ä¸­çš„è“ç‰™é…å¯¹å·¥ä½œæµç¨‹æ˜¯æ€Žæ ·çš„ï¼Ÿ
è“ç‰™é…å¯¹éµå¾ªä¸¤é˜¶æ®µæµç¨‹ï¼šé¦–å…ˆè¿›è¡Œ BLE å‘çŽ°ï¼Œç„¶åŽè¿›è¡Œç»å…¸è“ç‰™é…å¯¹ä»¥æ”¯æŒéŸ³é¢‘é…ç½®æ–‡ä»¶ã€‚

### 1. è“ç‰™é…å¯¹ç›¸å…³æ–‡ä»¶

**æ ¸å¿ƒå®žçŽ°æ–‡ä»¶ï¼š**
- `lib/connection/bt/r2_bluetooth_model.dart` - å¤„ç† BLE å’Œç»å…¸è“ç‰™çš„ä¸»è¦è“ç‰™æ¨¡åž‹
- `lib/devicemanager/r2_device_manager.dart` - è®¾å¤‡ç®¡ç†å’Œé…å¯¹ç¼–æŽ’
- `lib/screens/device_pairing_screen.dart` - è®¾å¤‡æ‰«æå’Œé€‰æ‹©çš„ç”¨æˆ·ç•Œé¢
- `android/app/src/main/kotlin/com/rockroad/r2cyclingapp/MainActivity.kt` - Android åŽŸç”Ÿè“ç‰™é…ç½®æ–‡ä»¶
- `lib/permission/r2_permission_manager.dart` - è“ç‰™æƒé™å¤„ç†

### 2. åº“å’Œæ–‡æ¡£

**ä¸»è¦è“ç‰™åº“ï¼š**
- **flutter_reactive_ble**ï¼šç”¨äºŽ BLE æ“ä½œï¼ˆæ‰«æã€è¿žæŽ¥ã€æ•°æ®ä¼ è¾“ï¼‰
  - æ–‡æ¡£ï¼šhttps://pub.dev/packages/flutter_reactive_ble
- **flutter_blue_classic**ï¼šç”¨äºŽç»å…¸è“ç‰™æ“ä½œï¼ˆé…å¯¹ã€éŸ³é¢‘é…ç½®æ–‡ä»¶ï¼‰
  - æ–‡æ¡£ï¼šhttps://pub.dev/packages/flutter_blue_classic
- **permission_handler**ï¼šç”¨äºŽè¿è¡Œæ—¶è“ç‰™æƒé™
  - æ–‡æ¡£ï¼šhttps://pub.dev/packages/permission_handler

### 3. é…å¯¹å·¥ä½œæµç¨‹

**æ­¥éª¤ 1ï¼šBLE å‘çŽ°**
```
1. è¯·æ±‚è“ç‰™æƒé™
2. å¼€å§‹ BLE æ‰«æï¼Œä½¿ç”¨å“ç‰Œè¿‡æ»¤å™¨ï¼ˆä¾‹å¦‚ 'EH201'ï¼‰
3. ç”¨æˆ·é€‰æ‹©å‘çŽ°çš„ BLE è®¾å¤‡
4. åœæ­¢ BLE æ‰«æ
```

**æ­¥éª¤ 2ï¼šç»å…¸è“ç‰™é…å¯¹**
```
1. ä»Ž BLE åç§°ä¸­æå–è®¾å¤‡æ ‡è¯†ç¬¦ï¼ˆæœ€åŽ 6 ä¸ªå­—ç¬¦ï¼‰
2. å¼€å§‹ç»å…¸è“ç‰™æ‰«æ
3. æŸ¥æ‰¾åç§°æ¨¡å¼ä¸º 'Helmet-{æ ‡è¯†ç¬¦}' çš„è®¾å¤‡
4. ä¸Žç»å…¸è“ç‰™è®¾å¤‡ç»‘å®š
5. å¯ç”¨ A2DP å’Œè€³æœºéŸ³é¢‘é…ç½®æ–‡ä»¶
6. å°†è®¾å¤‡ä¿¡æ¯ä¿å­˜åˆ°æœ¬åœ°æ•°æ®åº“
```

### 4. ä»£ç ç¤ºä¾‹ï¼šæ›´æ”¹äº§å“åž‹å·

**å°†äº§å“åž‹å·ä»Ž 'EH201' æ›´æ”¹ä¸ºå…¶ä»–åž‹å·ï¼š**

åœ¨ `lib/screens/device_pairing_screen.dart` ç¬¬ 89 è¡Œï¼š
```dart
// å½“å‰ä»£ç ï¼š
_scannedDevices = _btManager.scanDevices(brand: 'EH201');

// æ›´æ”¹ä¸ºæ–°åž‹å·ï¼ˆä¾‹å¦‚ 'EH202'ï¼‰ï¼š
_scannedDevices = _btManager.scanDevices(brand: 'EH202');
```

åœ¨ `lib/connection/bt/r2_bluetooth_model.dart` ç¬¬ 169 è¡Œï¼ˆç»å…¸è“ç‰™é…å¯¹é€»è¾‘ï¼‰ï¼š
```dart
// å½“å‰ä»£ç æŸ¥æ‰¾ï¼š
if (device.name!.startsWith('Helmet-$lastPart')) {

// å¦‚æžœå¤´ç›”å‘½åçº¦å®šå‘ç”Ÿå˜åŒ–ï¼Œä¿®æ”¹æ¨¡å¼ï¼š
if (device.name!.startsWith('NewHelmet-$lastPart')) {
```

**å…³é”®è¦ç‚¹ï¼š**
- EH201 æ˜¯æ™ºèƒ½å¤´ç›”çš„å¼€å‘æ¿åž‹å·
- è®¾å¤‡åç§°å¯ç”±å®¢æˆ·è‡ªå®šä¹‰ï¼ˆæ— ä¸¥æ ¼æ ¼å¼è¦æ±‚ï¼‰

## R2 éª‘è¡Œåº”ç”¨ä¸­çš„å®žæ—¶è¯­éŸ³å¯¹è®²æŠ€æœ¯æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

### 1. è¯­éŸ³å¯¹è®²ç›¸å…³æ–‡ä»¶å’Œæ¨¡å—

è¯­éŸ³å¯¹è®²åŠŸèƒ½ä¸»è¦ç”±ä»¥ä¸‹æ ¸å¿ƒæ–‡ä»¶å¤„ç†ï¼š
- `lib/intercom/r2_intercom_engine.dart` - ä¸»è¦çš„ Agora RTC å¼•æ“ŽåŒ…è£…å™¨å’Œè¯­éŸ³é€šä¿¡é€»è¾‘
- `lib/group/group_intercom_screen.dart` - ç¾¤ç»„è¯­éŸ³å¯¹è®²çš„ UI ç•Œé¢ï¼Œå…·æœ‰æŒ‰é”®é€šè¯åŠŸèƒ½
- `lib/connection/http/r2_http_request.dart` - ä»ŽæœåŠ¡å™¨èŽ·å– RTC ä»¤ç‰Œçš„ HTTP è¯·æ±‚

### 2. Agora RTC å¼•æ“Ž

**Agora RTC å¼•æ“Ž** æ˜¯ä¸€ä¸ªå®žæ—¶é€šä¿¡å¹³å°ï¼Œæä¾›è¯­éŸ³å’Œè§†é¢‘é€šè¯åŠŸèƒ½ã€‚å®ƒç”±å£°ç½‘ï¼ˆAgoraï¼‰å¼€å‘ï¼Œæä¾›ï¼š
- è¶…ä½Žå»¶è¿Ÿè¯­éŸ³é€šä¿¡
- é«˜è´¨é‡éŸ³é¢‘ä¼ è¾“
- å¤šå¹³å°æ”¯æŒï¼ˆiOSã€Androidã€Web ç­‰ï¼‰
- å¯æ‰©å±•çš„ç¾¤ç»„è¯­éŸ³èŠå¤©ï¼ˆæ”¯æŒæ•°åƒåå‚ä¸Žè€…ï¼‰

**å¼€å‘è€…èµ„æºï¼š**
- å®˜æ–¹ç½‘ç«™ï¼š[https://www.agora.io](https://www.agora.io)
- æ–‡æ¡£ï¼š[https://docs.agora.io](https://docs.agora.io)
- Flutter SDK æŒ‡å—ï¼š[https://docs.agora.io/en/voice-calling/get-started/get-started-sdk?platform=flutter](https://docs.agora.io/en/voice-calling/get-started/get-started-sdk?platform=flutter)

### 3. Agora é…ç½®

**å½“å‰ç‰ˆæœ¬ï¼š** `agora_rtc_engine: ^6.3.2`ï¼ˆåœ¨ pubspec.yaml ä¸­æŒ‡å®šï¼‰

**App Key å’Œ Token é…ç½®ï¼š**
- **ç¡¬ç¼–ç é…ç½®ï¼ˆæŽ¨èï¼‰ï¼š** åœ¨ `lib/intercom/r2_intercom_engine.dart` ä¸­è®¾ç½® `swAppId` å’Œ `swToken` å¸¸é‡ï¼ˆç¬¬ 10-11 è¡Œï¼‰
  ```dart
  const String swAppId = "your_agora_app_id_here";
  const String swToken = "your_agora_token_here";
  ```
- **åŠ¨æ€é…ç½®ï¼š** åº”ç”¨é€šè¿‡è°ƒç”¨åŽç«¯ API çš„ `_requestRTCToken()` æ–¹æ³•è‡ªåŠ¨ä»ŽæœåŠ¡å™¨è¯·æ±‚ä»¤ç‰Œ

**é‡è¦æç¤ºï¼š** å¼ºçƒˆå»ºè®®å¼€å‘è€…å’Œåˆ¶é€ å•†ç”³è¯·è‡ªå·±çš„ Agora app key/token å¹¶ä½¿ç”¨ç¡¬ç¼–ç é…ç½®è¿›è¡Œæµ‹è¯•ã€‚åŸºäºŽæœåŠ¡å™¨çš„ä»¤ç‰Œè¯·æ±‚ä»…ç”¨äºŽæµ‹è¯•ç›®çš„ï¼Œå¯¹è®²åŠŸèƒ½çš„å¯ç”¨æ—¶é—´éžå¸¸æœ‰é™ã€‚

**å¦‚ä½•èŽ·å– Agora å‡­æ®ï¼š**
1. åœ¨ [Agora æŽ§åˆ¶å°](https://console.agora.io) æ³¨å†Œ
2. åˆ›å»ºæ–°é¡¹ç›®ä»¥èŽ·å–æ‚¨çš„ App ID
3. ç”Ÿæˆç”¨äºŽæµ‹è¯•çš„ä¸´æ—¶ä»¤ç‰Œæˆ–ä¸ºç”Ÿäº§çŽ¯å¢ƒå®žçŽ°ä»¤ç‰ŒæœåŠ¡å™¨
4. åœ¨ `r2_intercom_engine.dart` é¡¶éƒ¨çš„å¸¸é‡ä¸­é…ç½®å‡­æ®

**ä¸»è¦åŠŸèƒ½ï¼š**
- æŒ‰é”®é€šè¯åŠŸèƒ½ï¼ˆæŒ‰ä½æŒ‰é’®è¯´è¯ï¼‰
- ä¸è¯´è¯æ—¶è‡ªåŠ¨é™éŸ³éº¦å…‹é£Ž
- æ”¯æŒæ¯ç»„æœ€å¤š 8 åæˆå‘˜

## Androidå’ŒiOSçš„å½“å‰ç¼–è¯‘é…ç½®æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨æ­¤é…ç½®ä¸‹ï¼Œæºä»£ç å·²æˆåŠŸç¼–è¯‘å¹¶éƒ¨ç½²åˆ°Androidæ‰‹æœºå’ŒiPhoneä¸Šã€‚

### Androidé…ç½®
Androidæž„å»ºé…ç½®åœ¨`android/app/build.gradle`ä¸­å®šä¹‰ï¼š

- **ç¼–è¯‘SDK**: 34
- **æœ€ä½ŽSDK**: 21 (Android 5.0 Lollipop)
- **ç›®æ ‡SDK**: 34 (Android 14)
- **å‘½åç©ºé—´**: `com.rockroad.r2cycling`
- **Kotlinç‰ˆæœ¬**: 1.7.10
- **Gradleç‰ˆæœ¬**: 7.5
- **Android Gradleæ’ä»¶**: 7.3.0

### iOSé…ç½®
iOSæž„å»ºé…ç½®åœ¨`ios/Runner.xcodeproj/project.pbxproj`ä¸­å®šä¹‰ï¼š

- **éƒ¨ç½²ç›®æ ‡**: â‰¥ iOS 12.0
- **Swiftç‰ˆæœ¬**: 5.0
- **Bundleæ ‡è¯†ç¬¦**: `com.rockroad.r2cycling`
- **æ”¯æŒå¹³å°**: iPhoneå’ŒiPad (iphoneos, iphonesimulator)
- **è®¾å¤‡ç³»åˆ—**: é€šç”¨ (iPhoneå’ŒiPad)
- **Bitcode**: å·²ç¦ç”¨

### Flutteré…ç½®
`pubspec.yaml`ä¸­çš„Flutteré¡¹ç›®é…ç½®ï¼š

- **Flutter SDK**: æœ€æ–°ç¨³å®šç‰ˆæœ¬
- **Dart SDK**: '>=3.1.0 <4.0.0'
- **ä¸»è¦ä¾èµ–é¡¹**:
  - `agora_rtc_engine: ^6.3.2`
  - `flutter_reactive_ble: ^5.3.1`
  - `geolocator: ^10.1.0`
  - `permission_handler: ^11.3.1`

# å¼•ç”¨
å¦‚æžœæ‚¨åœ¨ç ”ç©¶æˆ–é¡¹ç›®ä¸­ä½¿ç”¨R2éª‘è¡Œåº”ç”¨ï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@software{R2Cycling,
  author       = {Shen Ji and R2Cycling Contributors},
  title        = {R2Cycling: An Open Source Cycling App and Cloud API for Smart Helmets},
  year         = {2025},
  publisher    = {GitHub},
  url          = {https://github.com/shenjee/r2cyclingapp}
}
```

